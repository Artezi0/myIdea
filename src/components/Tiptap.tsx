import { useEditor, EditorContent } from '@tiptap/react'
import StarterKit from '@tiptap/starter-kit'
import Placeholder from '@tiptap/extension-placeholder'

import { UserAuth } from '../context/AuthContext'
import TextAlign from '@tiptap/extension-text-align'
import TaskList from '@tiptap/extension-task-list'
import TaskItem from '@tiptap/extension-task-item'
 
function MenuBar({ editor }) {
  if (!editor) {
    return null
  }

  return (
    <div className='edit__info-buttons'>
      <button 
        onClick={() => editor.chain().focus().toggleBold().run()}
        className={editor.isActive('bold') ? 'is-active' : ''}>
        <svg width="12" height="14" viewBox="0 0 12 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M2.22949 13.0264H6.87891C9.6123 13.0264 11.3525 11.585 11.3525 9.37891C11.3525 7.64746 10.0605 6.39062 8.25879 6.30273V6.22363C9.74414 6.03027 10.7725 4.91406 10.7725 3.49023C10.7725 1.50391 9.24316 0.291016 6.73828 0.291016H2.22949C1.23633 0.291016 0.647461 0.871094 0.647461 1.88184V11.4355C0.647461 12.4463 1.23633 13.0264 2.22949 13.0264ZM3.83789 5.54688V2.4707H5.72754C6.92285 2.4707 7.63477 3.02441 7.63477 3.96484C7.63477 4.94922 6.85254 5.54688 5.53418 5.54688H3.83789ZM3.83789 10.873V7.44531H5.78906C7.27441 7.44531 8.10938 8.04297 8.10938 9.1416C8.10938 10.2666 7.34473 10.873 5.87695 10.873H3.83789Z" fill="currentColor"/>
        </svg>
      </button>
      <button 
        onClick={() => editor.chain().focus().toggleItalic().run()}
        className={editor.isActive('italic') ? 'is-active' : ''}>
        <svg width="10" height="14" viewBox="0 0 10 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.16797 13.0264H6.79297C7.31152 13.0264 7.66309 12.7188 7.66309 12.2002C7.66309 11.708 7.32031 11.4004 6.80176 11.4004H5.00879L7.04785 1.91699H8.83203C9.35059 1.91699 9.71094 1.60938 9.71094 1.09961C9.71094 0.598633 9.35938 0.291016 8.84082 0.291016H3.19824C2.67969 0.291016 2.32812 0.598633 2.32812 1.09961C2.32812 1.60938 2.68848 1.91699 3.20703 1.91699H4.99121L2.95215 11.4004H1.15918C0.640625 11.4004 0.289062 11.708 0.289062 12.2002C0.289062 12.7188 0.649414 13.0264 1.16797 13.0264Z" fill="currentColor"/>
        </svg>
      </button>
      <button
        onClick={() => editor.chain().focus().toggleStrike().run()}
        className={editor.isActive('strike') ? 'is-active' : ''}>
        <svg width="16" height="14" viewBox="0 0 16 14" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M0.986328 7.08496H6.04883C6.26855 7.15527 6.50586 7.2168 6.75195 7.26953L8.41309 7.64746C10.1797 8.05176 10.8916 8.58789 10.8916 9.57227C10.8916 10.7236 9.70508 11.5674 7.96484 11.5674C6.43555 11.5674 5.27539 10.873 4.77441 9.72168C4.56348 9.34375 4.33496 9.16797 3.93945 9.16797C3.37695 9.16797 3.02539 9.51953 3.02539 10.0557C3.02539 10.2314 3.05176 10.416 3.11328 10.6006C3.59668 12.2266 5.47754 13.2549 7.96484 13.2549C11.0146 13.2549 12.9746 11.708 12.9746 9.32617C12.9746 8.37695 12.6846 7.64746 12.0693 7.08496H15.0049C15.2861 7.08496 15.4971 6.85645 15.4971 6.59277C15.4971 6.32031 15.2861 6.10059 15.0049 6.10059H10.2061C9.89844 6.00391 9.57324 5.91602 9.21289 5.83691L7.70117 5.49414C5.99609 5.09863 5.27539 4.59766 5.27539 3.6748C5.27539 2.5498 6.3916 1.75879 7.95605 1.75879C9.35352 1.75879 10.3291 2.37402 10.8301 3.49902C11.041 3.85059 11.2783 4.01758 11.6826 4.01758C12.2275 4.01758 12.5703 3.68359 12.5703 3.16504C12.5703 3.01562 12.5527 2.86621 12.5088 2.72559C12.0869 1.14355 10.2852 0.0625 7.94727 0.0625C5.1875 0.0625 3.19238 1.61816 3.19238 3.85059C3.19238 4.78223 3.5 5.5293 4.1416 6.10059H0.986328C0.713867 6.10059 0.494141 6.32031 0.494141 6.59277C0.494141 6.85645 0.713867 7.08496 0.986328 7.08496Z" fill="currentColor"/>
        </svg>     
      </button>
      <button
        onClick={() => editor.chain().focus().toggleCode().run()}
        className={editor.isActive('code') ? 'is-active' : ''}>
        <svg width="14" height="15" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M7.99121 0.427734C7.70996 0.427734  7.46387 0.55957 7.17383 0.788086L1.24121 5.58691C1.03027 5.7627 0.898438 6.02637 0.898438 6.35156C0.898438 6.94922 1.38184 7.38867 1.93555 7.38867C2.19043 7.38867 2.44531 7.29199 2.7002 7.08984L8 2.81836L13.291 7.08984C13.5371 7.29199 13.8008 7.38867 14.0557 7.38867C14.6094 7.38867 15.0928 6.94922 15.0928 6.35156C15.0928 6.02637 14.9609 5.7627 14.75 5.58691L8.80859 0.788086C8.52734 0.55957 8.28125 0.427734 7.99121 0.427734ZM7.99121 16.7139C8.28125 16.7139 8.52734 16.5908 8.80859 16.3623L14.75 11.5635C14.9609 11.3789 15.0928 11.1152 15.0928 10.7988C15.0928 10.1924 14.6094 9.75293 14.0557 9.75293C13.8008 9.75293 13.5371 9.8584 13.291 10.0605L8 14.332L2.7002 10.0605C2.44531 9.8584 2.19043 9.75293 1.93555 9.75293C1.38184 9.75293 0.898438 10.1924 0.898438 10.7988C0.898438 11.1152 1.03027 11.3789 1.24121 11.5635L7.17383 16.3535C7.46387 16.5908 7.70996 16.7139 7.99121 16.7139Z" fill="currentColor"/>
        </svg>
      </button> 
      <button
        onClick={() => editor.chain().focus().toggleHeading({ level: 1 }).run()}
        className={editor.isActive('heading', { level: 1 }) ? 'is-active' : ''}>
        H1
      </button>
      <button
        onClick={() => editor.chain().focus().toggleHeading({ level: 2 }).run()}
        className={editor.isActive('heading', { level: 2 }) ? 'is-active' : ''}>
        H2
      </button>
      <button
        onClick={() => editor.chain().focus().toggleHeading({ level: 3 }).run()}
        className={editor.isActive('heading', { level: 3 }) ? 'is-active' : ''}>
        H3
      </button>
      <button
        onClick={() => editor.chain().focus().toggleBulletList().run()}
        className={editor.isActive('bulletList') ? 'is-active' : ''}>
          <svg width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2.16016 2.50586C2.85449 2.50586 3.4082 1.95215 3.4082 1.25781C3.4082 0.572266 2.85449 0.00976562 2.16016 0.00976562C1.47461 0.00976562 0.912109 0.572266 0.912109 1.25781C0.912109 1.95215 1.47461 2.50586 2.16016 2.50586ZM6.29102 2.10156H18.2266C18.7012 2.10156 19.0791 1.73242 19.0791 1.25781C19.0791 0.783203 18.71 0.414062 18.2266 0.414062H6.29102C5.8252 0.414062 5.44727 0.783203 5.44727 1.25781C5.44727 1.73242 5.81641 2.10156 6.29102 2.10156ZM2.16016 7.91113C2.85449 7.91113 3.4082 7.35742 3.4082 6.66309C3.4082 5.97754 2.85449 5.41504 2.16016 5.41504C1.47461 5.41504 0.912109 5.97754 0.912109 6.66309C0.912109 7.35742 1.47461 7.91113 2.16016 7.91113ZM6.29102 7.50684H18.2266C18.7012 7.50684 19.0791 7.1377 19.0791 6.66309C19.0791 6.18848 18.71 5.81934 18.2266 5.81934H6.29102C5.8252 5.81934 5.44727 6.18848 5.44727 6.66309C5.44727 7.1377 5.81641 7.50684 6.29102 7.50684ZM2.16016 13.3164C2.85449 13.3164 3.4082 12.7627 3.4082 12.0684C3.4082 11.3828 2.85449 10.8203 2.16016 10.8203C1.47461 10.8203 0.912109 11.3828 0.912109 12.0684C0.912109 12.7627 1.47461 13.3164 2.16016 13.3164ZM6.29102 12.9121H18.2266C18.7012 12.9121 19.0791 12.543 19.0791 12.0684C19.0791 11.5938 18.71 11.2246 18.2266 11.2246H6.29102C5.8252 11.2246 5.44727 11.5938 5.44727 12.0684C5.44727 12.543 5.81641 12.9121 6.29102 12.9121Z" fill="currentColor"/>
          </svg>
      </button>
      <button
        onClick={() => editor.chain().focus().toggleOrderedList().run()}
        className={editor.isActive('orderedList') ? 'is-active' : ''}>
        <svg width="20" height="17" viewBox="0 0 20 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M2.88086 5.12109C3.24121 5.12109 3.4873 4.92773 3.4873 4.48828V1.63184C3.4873 1.23633 3.20605 0.990234 2.80176 0.990234C2.47656 0.990234 2.27441 1.10449 2.03711 1.25391L1.41309 1.68457C1.21973 1.80762 1.13184 1.93066 1.13184 2.13281C1.13184 2.37891 1.31641 2.5459 1.52734 2.53711C1.6416 2.53711 1.70312 2.51953 1.85254 2.41406L2.24805 2.15039H2.26562V4.48828C2.26562 4.92773 2.51172 5.12109 2.88086 5.12109ZM6.63379 4.10156H18.2266C18.7012 4.10156 19.0791 3.73242 19.0791 3.25781C19.0791 2.7832 18.71 2.41406 18.2266 2.41406H6.63379C6.15918 2.41406 5.79004 2.7832 5.79004 3.25781C5.79004 3.73242 6.15918 4.10156 6.63379 4.10156ZM1.43945 10.5088H3.75098C4.00586 10.5088 4.20801 10.333 4.20801 10.0605C4.20801 9.7793 4.01465 9.60352 3.75098 9.60352H2.51172V9.58594L3.22363 9.01465C3.83008 8.52246 4.08496 8.24121 4.08496 7.70508C4.08496 6.97559 3.46973 6.49219 2.48535 6.49219C1.61523 6.49219 0.991211 6.93164 0.991211 7.50293C0.991211 7.80176 1.18457 7.95996 1.50098 7.95996C1.70312 7.95996 1.85254 7.88965 1.98438 7.69629C2.11621 7.49414 2.27441 7.38867 2.50293 7.38867C2.74902 7.38867 2.9248 7.54688 2.9248 7.78418C2.9248 7.99512 2.81934 8.16211 2.3623 8.54004L1.19336 9.48926C1.01758 9.63867 0.938477 9.79688 0.938477 10.0078C0.938477 10.2979 1.13184 10.5088 1.43945 10.5088ZM6.63379 9.50684H18.2266C18.7012 9.50684 19.0791 9.1377 19.0791 8.66309C19.0791 8.18848 18.71 7.81934 18.2266 7.81934H6.63379C6.15918 7.81934 5.79004 8.18848 5.79004 8.66309C5.79004 9.1377 6.15918 9.50684 6.63379 9.50684ZM2.50293 16.0547C3.59277 16.0547 4.22559 15.5801 4.22559 14.8242C4.22559 14.3232 3.88281 13.9893 3.25879 13.9365V13.9102C3.70703 13.8223 4.06738 13.5146 4.06738 12.9961C4.06738 12.3018 3.38184 11.9326 2.49414 11.9326C1.79102 11.9326 1.00879 12.249 1.00879 12.8555C1.00879 13.1191 1.20215 13.3037 1.4834 13.3037C1.68555 13.3037 1.78223 13.2246 1.90527 13.0928C2.11621 12.873 2.2832 12.8115 2.49414 12.8115C2.75781 12.8115 2.95117 12.9346 2.95117 13.1895C2.95117 13.4268 2.75781 13.5498 2.40625 13.5498H2.29199C2.0459 13.5498 1.87891 13.6816 1.87891 13.9541C1.87891 14.209 2.03711 14.3496 2.29199 14.3496H2.41504C2.79297 14.3496 2.99512 14.4727 3.00391 14.7363C3.00391 14.9736 2.78418 15.1318 2.50293 15.1318C2.18652 15.1318 1.9668 14.9561 1.7998 14.8066C1.69434 14.71 1.59766 14.6309 1.43066 14.6309C1.12305 14.6309 0.912109 14.8066 0.912109 15.1055C0.912109 15.7119 1.75586 16.0547 2.50293 16.0547ZM6.63379 14.9121H18.2266C18.7012 14.9121 19.0791 14.543 19.0791 14.0684C19.0791 13.5938 18.71 13.2246 18.2266 13.2246H6.63379C6.15918 13.2246 5.79004 13.5938 5.79004 14.0684C5.79004 14.543 6.15918 14.9121 6.63379 14.9121Z" fill="currentColor"/>
        </svg>
      </button>
      <button
        onClick={() => editor.chain().focus().setTextAlign('left').run()}
        className={editor.isActive({ textAlign: 'left' }) ? 'is-active' : ''}>
        <svg width="20" height="17" viewBox="0 0 20 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.69434 2.50195H18.2881C18.7275 2.50195 19.0791 2.15918 19.0791 1.71973C19.0791 1.28906 18.7275 0.9375 18.2881 0.9375H1.69434C1.25488 0.9375 0.912109 1.28906 0.912109 1.71973C0.912109 2.15918 1.25488 2.50195 1.69434 2.50195ZM1.69434 7.10742H11.5469C11.9863 7.10742 12.3379 6.76465 12.3379 6.3252C12.3379 5.88574 11.9863 5.54297 11.5469 5.54297H1.69434C1.25488 5.54297 0.912109 5.88574 0.912109 6.3252C0.912109 6.76465 1.25488 7.10742 1.69434 7.10742ZM1.69434 11.7129H18.2881C18.7275 11.7129 19.0791 11.3701 19.0791 10.9307C19.0791 10.4912 18.7275 10.1484 18.2881 10.1484H1.69434C1.25488 10.1484 0.912109 10.4912 0.912109 10.9307C0.912109 11.3701 1.25488 11.7129 1.69434 11.7129ZM1.69434 16.3184H11.5469C11.9863 16.3184 12.3379 15.9668 12.3379 15.5361C12.3379 15.0967 11.9863 14.7539 11.5469 14.7539H1.69434C1.25488 14.7539 0.912109 15.0967 0.912109 15.5361C0.912109 15.9668 1.25488 16.3184 1.69434 16.3184Z" fill="currentColor"/>
        </svg>
      </button>
      <button
        onClick={() => editor.chain().focus().setTextAlign('center').run()}
        className={editor.isActive({ textAlign: 'center' }) ? 'is-active' : ''}>
        <svg width="20" height="17" viewBox="0 0 20 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.69434 2.50195H18.2881C18.7275 2.50195 19.0791 2.15918 19.0791 1.71973C19.0791 1.28906 18.7275 0.9375 18.2881 0.9375H1.69434C1.25488 0.9375 0.912109 1.28906 0.912109 1.71973C0.912109 2.15918 1.25488 2.50195 1.69434 2.50195ZM5.06055 7.10742H14.9131C15.3525 7.10742 15.7041 6.76465 15.7041 6.3252C15.7041 5.88574 15.3525 5.54297 14.9131 5.54297H5.06055C4.62988 5.54297 4.27832 5.88574 4.27832 6.3252C4.27832 6.76465 4.62988 7.10742 5.06055 7.10742ZM1.69434 11.7129H18.2881C18.7275 11.7129 19.0791 11.3701 19.0791 10.9307C19.0791 10.4912 18.7275 10.1484 18.2881 10.1484H1.69434C1.25488 10.1484 0.912109 10.4912 0.912109 10.9307C0.912109 11.3701 1.25488 11.7129 1.69434 11.7129ZM5.06055 16.3184H14.9131C15.3525 16.3184 15.7041 15.9668 15.7041 15.5361C15.7041 15.0967 15.3525 14.7539 14.9131 14.7539H5.06055C4.62988 14.7539 4.27832 15.0967 4.27832 15.5361C4.27832 15.9668 4.62988 16.3184 5.06055 16.3184Z" fill="currentColor"/>  
        </svg>
      </button>
      <button
        onClick={() => editor.chain().focus().setTextAlign('right').run()}
        className={editor.isActive({ textAlign: 'right' }) ? 'is-active' : ''}>
        <svg width="20" height="17" viewBox="0 0 20 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.69434 2.50195H18.2881C18.7275 2.50195 19.0791 2.15918 19.0791 1.71973C19.0791 1.28906 18.7275 0.9375 18.2881 0.9375H1.69434C1.25488 0.9375 0.912109 1.28906 0.912109 1.71973C0.912109 2.15918 1.25488 2.50195 1.69434 2.50195ZM8.43555 7.10742H18.2881C18.7275 7.10742 19.0791 6.76465 19.0791 6.3252C19.0791 5.88574 18.7275 5.54297 18.2881 5.54297H8.43555C7.99609 5.54297 7.65332 5.88574 7.65332 6.3252C7.65332 6.76465 7.99609 7.10742 8.43555 7.10742ZM1.69434 11.7129H18.2881C18.7275 11.7129 19.0791 11.3701 19.0791 10.9307C19.0791 10.4912 18.7275 10.1484 18.2881 10.1484H1.69434C1.25488 10.1484 0.912109 10.4912 0.912109 10.9307C0.912109 11.3701 1.25488 11.7129 1.69434 11.7129ZM8.43555 16.3184H18.2881C18.7275 16.3184 19.0791 15.9668 19.0791 15.5361C19.0791 15.0967 18.7275 14.7539 18.2881 14.7539H8.43555C7.99609 14.7539 7.65332 15.0967 7.65332 15.5361C7.65332 15.9668 7.99609 16.3184 8.43555 16.3184Z" fill="currentColor"/>
        </svg>
      </button>
      <button
        onClick={() => editor.chain().focus().setTextAlign('justify').run()}
        className={editor.isActive({ textAlign: 'justify' }) ? 'is-active' : ''}>
        <svg width="20" height="17" viewBox="0 0 20 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.71191 2.48438H18.2705C18.7188 2.48438 19.0791 2.11523 19.0791 1.67578C19.0791 1.21875 18.7188 0.867188 18.2705 0.867188H1.71191C1.26367 0.867188 0.912109 1.22754 0.912109 1.67578C0.912109 2.11523 1.26367 2.48438 1.71191 2.48438ZM1.71191 7.08984H18.2705C18.7188 7.08984 19.0791 6.7207 19.0791 6.28125C19.0791 5.82422 18.7188 5.47266 18.2705 5.47266H1.71191C1.26367 5.47266 0.912109 5.83301 0.912109 6.28125C0.912109 6.7207 1.26367 7.08984 1.71191 7.08984ZM1.71191 11.6953H18.2705C18.7188 11.6953 19.0791 11.3262 19.0791 10.8867C19.0791 10.4385 18.7188 10.0781 18.2705 10.0781H1.71191C1.26367 10.0781 0.912109 10.4385 0.912109 10.8867C0.912109 11.3262 1.26367 11.6953 1.71191 11.6953ZM1.71191 16.3008H18.2705C18.7188 16.3008 19.0791 15.9316 19.0791 15.4922C19.0791 15.0439 18.7188 14.6836 18.2705 14.6836H1.71191C1.26367 14.6836 0.912109 15.0439 0.912109 15.4922C0.912109 15.9316 1.26367 16.3008 1.71191 16.3008Z" fill="currentColor"/>
        </svg>
      </button>
      <button
        onClick={() => editor.chain().focus().toggleTaskList().run()}
        className={editor.isActive('taskList') ? 'is-active' : ''}>
        <svg width="18" height="17" viewBox="0 0 18 17" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3.67383 16.8809H14.3174C16.2246 16.8809 17.209 15.8965 17.209 14.0156V3.31934C17.209 1.43848 16.2246 0.454102 14.3174 0.454102H3.67383C1.77539 0.454102 0.782227 1.42969 0.782227 3.31934V14.0156C0.782227 15.8965 1.77539 16.8809 3.67383 16.8809ZM3.78809 15.1318C2.97949 15.1318 2.53125 14.71 2.53125 13.8574V3.47754C2.53125 2.625 2.97949 2.20312 3.78809 2.20312H14.2031C15.0029 2.20312 15.46 2.625 15.46 3.47754V13.8574C15.46 14.71 15.0029 15.1318 14.2031 15.1318H3.78809ZM6.79395 12.2051C6.97852 12.2051 7.11914 12.1699 7.26855 12.0908L12.3486 9.48926C12.7354 9.28711 12.9199 9.0498 12.9199 8.66309C12.9199 8.29395 12.7266 8.03027 12.3486 7.82812L7.26855 5.13867C7.11035 5.06836 6.97852 5.02441 6.77637 5.02441C6.31055 5.02441 5.97656 5.36719 5.97656 5.82422C5.97656 6.19336 6.15234 6.43066 6.5918 6.63281L10.6348 8.60156V8.66309L6.5918 10.6055C6.15234 10.7988 5.97656 11.0273 5.97656 11.4053C5.97656 11.8623 6.31934 12.2051 6.79395 12.2051Z" fill="currentColor"/>
        </svg>
      </button>
    </div>
  )
}

export default function Tiptap() {
  const { getActive, onUpdate } = UserAuth()

  function onEdit(field, value) {
    onUpdate({
      ...getActive(),
      [field]: value,
    })
  }

  const editor = useEditor({
    extensions: [
      StarterKit,
      TaskList,
      TaskItem.configure({
        nested: true
      }),
      Placeholder.configure({
        placeholder: 'Write something...'
      }),
      TextAlign.configure({
        types: ['heading', 'paragraph'],
      }),
    ],
    content: getActive().body,  
    onUpdate({ editor }) {
      onEdit('body', editor.getHTML())
    },
  })

  return (
    <>
      <MenuBar editor={editor} />
      <EditorContent 
        editor={editor} 
        className='edit__info-body'
        spellCheck={false}
      />
    </>
  )
}